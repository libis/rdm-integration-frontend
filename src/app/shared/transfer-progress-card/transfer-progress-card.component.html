<!-- Author: Eryk Kulikowski @ KU Leuven (2025). Apache 2.0 License -->
@if (hasStatus) {
  <div #cardRoot class="transfer-status">
    <div class="status-row" [ngClass]="statusTone">
      <i class="status-icon" [ngClass]="statusIcon" aria-hidden="true"></i>
      <div class="status-body">
        <div class="status-message">{{ statusMessage }}</div>

        @if (filesSummary.total || filesSummary.failed) {
          <div class="status-files">
            <div class="status-files-header">
              <span class="status-files-label">Files processed</span>
              @if (filesSummary.total) {
                <span class="status-files-count">
                  {{ filesSummary.processed | number }}/{{
                    filesSummary.total | number
                  }}
                </span>
              } @else {
                <span class="status-files-count">0</span>
              }
            </div>

            @if (filesSummary.total) {
              <p-progressbar
                [value]="filesProgressPercent"
                [showValue]="false"
              ></p-progressbar>
            }

            @if (filesSummary.failed) {
              <div class="status-files-failed">
                Failed: {{ filesSummary.failed }}
              </div>
            }
          </div>
        }

        @if (status?.completion_time) {
          <div class="status-timestamp">
            Completed at: {{ status?.completion_time }}
          </div>
        } @else if (status?.request_time) {
          <div class="status-timestamp">
            Started at: {{ status?.request_time }}
          </div>
        }

        @if (taskId) {
          <div class="status-task">
            Task ID: <code>{{ taskId }}</code>
          </div>
        }
      </div>
    </div>

    @if (taskId || formattedMonitorUrl) {
      <div class="status-actions">
        @if (
          taskId &&
          !statusPollingActive &&
          (status?.status || "").toUpperCase() !== "SUCCEEDED"
        ) {
          <button
            pButton
            type="button"
            class="p-button-outlined p-button-secondary p-button-sm"
            (click)="refresh()"
          >
            <i class="pi pi-refresh"></i>
            <span>Refresh status</span>
          </button>
        }

        @if (formattedMonitorUrl) {
          <button
            pButton
            type="button"
            class="p-button-raised p-button-primary p-button-sm monitor-link"
            (click)="openGlobus()"
          >
            <i class="pi pi-external-link"></i>
            <span>Open in Globus</span>
          </button>
        }
      </div>
    }
  </div>
}
